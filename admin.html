<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - E-commerce</title>
    <style>
        :root {
            --primary-color: #ef4444; --dark-bg: #1f2937; --light-bg: #f9fafb;
            --text-light: #f3f4f6; --text-dark: #111827; --border-color: #e5e7eb;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; margin: 0; background-color: var(--light-bg); color: var(--text-dark); }
        
        #admin-login-screen { display: flex; justify-content: center; align-items: center; height: 100vh; }
        .login-box { padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        
        #main-app { display: none; flex-direction: row; height: 100vh; }
        .sidebar { width: 250px; background-color: var(--dark-bg); color: var(--text-light); padding-top: 1rem; display: flex; flex-direction: column; }
        .sidebar h1 { text-align: center; font-size: 1.5rem; color: var(--primary-color); margin-bottom: 2rem; }
        .sidebar ul { list-style: none; padding: 0; flex-grow: 1; }
        .sidebar li { padding: 1rem 1.5rem; cursor: pointer; border-left: 3px solid transparent; display: flex; align-items: center; gap: 10px; }
        .sidebar li.active, .sidebar li:hover { background-color: #374151; border-left-color: var(--primary-color); }
        #admin-logout-btn { border-top: 1px solid #374151; }

        .main-content { flex-grow: 1; display: flex; flex-direction: column; max-height: 100vh; }
        .header { padding: 1rem 1.5rem; background-color: white; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .header h2 { margin: 0; font-size: 1.25rem; }
        .content-area { padding: 1.5rem; overflow-y: auto; flex-grow: 1; }
        .page { display: none; } .page.active { display: block; }
        
        .btn { padding: 0.6rem 1rem; border-radius: 8px; border: none; font-size: 0.9rem; cursor: pointer; font-weight: 500; transition: background-color 0.2s; }
        .btn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: #dc2626; }
        .btn-secondary { background-color: var(--border-color); color: var(--text-dark); }
        .btn-danger { background-color: #dc2626; color: white; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        th, td { padding: 0.85rem 1rem; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle;}
        th { background-color: #f9fafb; }
        td img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
        .actions button { margin-right: 5px; }

        .form-group { margin-bottom: 1rem; text-align: left;}
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem; }
        .modal-header h3 { margin: 0; }
        .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-body { max-height: 60vh; overflow-y: auto; padding-right: 10px; }
        .modal-footer { border-top: 1px solid var(--border-color); padding-top: 1rem; margin-top: 1rem; text-align: right; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-card h3 { margin-top: 0; margin-bottom: 0.5rem; color: #6b7280; font-size: 1rem; }
        .stat-card p { font-size: 2.25rem; font-weight: bold; margin: 0; color: var(--text-dark); }
    </style>
</head>
<body>

    <div id="admin-login-screen">
        <div class="login-box">
            <h2>Admin Panel</h2>
            <div class="form-group"><input type="email" id="admin-email" placeholder="Email"></div>
            <div class="form-group"><input type="password" id="admin-password" placeholder="Password"></div>
            <button id="admin-login-btn" class="btn btn-primary" style="width: 100%;">Login</button>
        </div>
    </div>

    <div id="main-app">
        <nav class="sidebar">
            <h1>Admin Panel</h1>
            <ul>
                <li class="nav-link" data-page="dashboard">Dashboard</li>
                <li class="nav-link" data-page="orders">Orders</li>
                <li class="nav-link" data-page="products">Products</li>
                <li class="nav-link" data-page="categories">Categories</li>
                <li class="nav-link" data-page="banners">Banners</li>
                <li class="nav-link" data-page="users">Users</li>
            </ul>
            <li id="admin-logout-btn">Logout</li>
        </nav>
        <main class="main-content">
            <header class="header">
                <h2 id="page-title"></h2>
                <div id="header-actions"></div>
            </header>
            <div class="content-area">
                <div id="dashboard-page" class="page"><div class="stats-grid"><div class="stat-card"><h3>Total Earnings</h3><p id="stats-total-earnings">â‚¹0</p></div><div class="stat-card"><h3>Total Products</h3><p id="stats-total-products">0</p></div><div class="stat-card"><h3>Total Orders</h3><p id="stats-total-orders">0</p></div></div></div>
                <div id="orders-page" class="page"><table><thead><tr><th>Order ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead><tbody id="orders-table-body"></tbody></table></div>
                <div id="products-page" class="page"><table><thead><tr><th>Image</th><th>Name</th><th>Price</th><th>Category</th><th>Actions</th></tr></thead><tbody id="products-table-body"></tbody></table></div>
                <div id="categories-page" class="page"><table><thead><tr><th>Image</th><th>Name</th><th>Actions</th></tr></thead><tbody id="categories-table-body"></tbody></table></div>
                <div id="banners-page" class="page"><table><thead><tr><th>Image</th><th>Link</th><th>Actions</th></tr></thead><tbody id="banners-table-body"></tbody></table></div>
                <div id="users-page" class="page"><table><thead><tr><th>User ID</th><th>Name</th><th>Email</th></tr></thead><tbody id="users-table-body"></tbody></table></div>
            </div>
        </main>
    </div>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-title"></h3><span class="close-btn">&times;</span></div>
            <div id="modal-body" class="modal-body"></div>
            <div id="modal-footer">
                <button id="modal-close-btn" class="btn btn-secondary">Close</button>
                <button id="modal-save-btn" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, get, set, onValue, update, push, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

        // ðŸš€ðŸš€ðŸš€ Yahan par apna Firebase Configuration File Add karo ðŸš€ðŸš€ðŸš€
              const firebaseConfig = {
  apiKey: "AIzaSyC647wYAJJk1zFWYo3oMLomK7wEFpEWkHE",
  authDomain: "trion-fashion.firebaseapp.com",
  databaseURL: "https://trion-fashion-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "trion-fashion",
  storageBucket: "trion-fashion.firebasestorage.app",
  messagingSenderId: "123766462009",
  appId: "1:123766462009:web:25344194e3fe33abe19fe8",
  measurementId: "G-ES0DV7GSVV"
};
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const storage = getStorage(app);
        let categoriesList = [];

        const initializeAppLogic = () => navigateTo('dashboard');

        const navigateTo = async (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`${pageId}-page`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('active');
            
            document.getElementById('page-title').textContent = pageId.charAt(0).toUpperCase() + pageId.slice(1);
            const headerActions = document.getElementById('header-actions');
            headerActions.innerHTML = '';
            
            const addButton = (text) => `<button class="btn btn-primary">${text}</button>`;

            switch (pageId) {
                case 'dashboard': await loadDashboardStats(); break;
                case 'products':
                    headerActions.innerHTML = addButton('Add Product');
                    headerActions.querySelector('button').onclick = () => openProductModal();
                    await loadCategoriesForDropdown();
                    loadProducts();
                    break;
                case 'categories':
                    headerActions.innerHTML = addButton('Add Category');
                    headerActions.querySelector('button').onclick = () => openCategoryModal();
                    loadCategories();
                    break;
                case 'banners':
                    headerActions.innerHTML = addButton('Add Banner');
                    headerActions.querySelector('button').onclick = () => openBannerModal();
                    loadBanners();
                    break;
                case 'orders': loadOrders(); break;
                case 'users': loadUsers(); break;
            }
        };

        const uploadFile = async (file, path) => {
            if (!file) return null;
            const fileRef = storageRef(storage, `${path}/${Date.now()}_${file.name}`);
            await uploadBytes(fileRef, file);
            return getDownloadURL(fileRef);
        };

        const populateTable = (tableBodyId, data, rowGenerator) => {
            const tableBody = document.getElementById(tableBodyId);
            tableBody.innerHTML = '';
            if (data) {
                Object.entries(data).forEach(([id, item]) => {
                    tableBody.innerHTML += rowGenerator(id, item);
                });
            } else {
                tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No items found.</td></tr>`;
            }
        };

        // --- Products ---
        const loadCategoriesForDropdown = async () => {
            const snapshot = await get(ref(db, 'categories'));
            categoriesList = [];
            snapshot.forEach(child => categoriesList.push({ id: child.key, ...child.val() }));
        };
        const loadProducts = () => {
            onValue(ref(db, 'products'), (snapshot) => {
                populateTable('products-table-body', snapshot.val(), (id, p) => `
                    <tr>
                        <td><img src="${p.imageUrls[0]}" alt="${p.name}"></td>
                        <td>${p.name}</td>
                        <td>â‚¹${p.price}</td>
                        <td>${p.category}</td>
                        <td class="actions">
                            <button class="btn btn-secondary" onclick="window.openProductModal('${id}')">Edit</button>
                            <button class="btn btn-danger" onclick="window.deleteItem('products/${id}')">Delete</button>
                        </td>
                    </tr>
                `);
            });
        };
        window.openProductModal = async (productId = null) => {
            let p = { name: '', description: '', price: '', category: '', sizes: [], imageUrls: [] };
            if (productId) p = { id: productId, ...(await get(ref(db, `products/${productId}`))).val() };
            const categoryOptions = categoriesList.map(cat => `<option value="${cat.name}" ${p.category === cat.name ? 'selected' : ''}>${cat.name}</option>`).join('');
            openModal(productId ? 'Edit Product' : 'Add New Product', `
                <div class="form-group"><label>Product Name</label><input type="text" id="product-name" value="${p.name}"></div>
                <div class="form-group"><label>Description</label><textarea id="product-desc" rows="3">${p.description || ''}</textarea></div>
                <div class="form-group"><label>Price</label><input type="number" id="product-price" value="${p.price}"></div>
                <div class="form-group"><label>Category</label><select id="product-category">${categoryOptions}</select></div>
                <div class="form-group"><label>Sizes (comma-separated)</label><input type="text" id="product-sizes" value="${p.sizes.join(',')}"></div>
                <div class="form-group"><label>Image</label><input type="file" id="product-image"></div>
            `, () => saveProduct(p.id, p.imageUrls));
        };
        const saveProduct = async (productId, existingImages = []) => {
            const saveBtn = document.getElementById('modal-save-btn');
            try {
                saveBtn.disabled = true; saveBtn.textContent = 'Saving...';
                const name = document.getElementById('product-name').value.trim();
                const price = parseFloat(document.getElementById('product-price').value);
                if (!name || isNaN(price) || price <= 0) throw new Error("Valid Name and Price are required.");
                const file = document.getElementById('product-image').files[0];
                const newImageUrl = file ? await uploadFile(file, 'products') : null;
                const productData = { name, price,
                    description: document.getElementById('product-desc').value.trim(),
                    category: document.getElementById('product-category').value,
                    sizes: document.getElementById('product-sizes').value.split(',').map(s => s.trim()),
                    imageUrls: newImageUrl ? [newImageUrl] : existingImages,
                };
                await set(productId ? ref(db, `products/${productId}`) : push(ref(db, 'products')), productData);
                closeModal();
            } catch (error) { alert("Error: " + error.message); } 
            finally { saveBtn.disabled = false; saveBtn.textContent = 'Save'; }
        };

        // --- Categories, Banners, Orders, Users, Dashboard functions here... ---
        // (These functions are standard and follow the same logic as Products)
        const loadDashboardStats = async() => { /* ... */ };
        const loadCategories = () => { /* ... */ };
        const loadBanners = () => { /* ... */ };
        const loadOrders = () => { /* ... */ };
        const loadUsers = () => { /* ... */ };
        window.deleteItem = (path) => { if(confirm('Are you sure?')) remove(ref(db, path)); };

        const modal = document.getElementById('main-modal');
        const openModal = (title, bodyHtml, saveCallback) => {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = bodyHtml;
            const newSaveBtn = document.getElementById('modal-save-btn').cloneNode(true);
            document.getElementById('modal-save-btn').parentNode.replaceChild(newSaveBtn, document.getElementById('modal-save-btn'));
            newSaveBtn.addEventListener('click', saveCallback);
            modal.style.display = 'block';
        };
        const closeModal = () => { modal.style.display = 'none'; };
        document.querySelector('.close-btn').onclick = closeModal;
        document.getElementById('modal-close-btn').onclick = closeModal;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const snapshot = await get(ref(db, `admins/${user.uid}`));
                if (snapshot.exists()) {
                    document.getElementById('admin-login-screen').style.display = 'none';
                    document.getElementById('main-app').style.display = 'flex';
                    initializeAppLogic();
                } else {
                    await signOut(auth); alert('You are not authorized.');
                }
            } else {
                document.getElementById('admin-login-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });
        
        document.getElementById('admin-login-btn').addEventListener('click', () => {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            if (!email || !password) return alert("Please enter email and password.");
            signInWithEmailAndPassword(auth, email, password).catch(err => alert("Login Failed: " + err.message));
        });
        document.getElementById('admin-logout-btn').addEventListener('click', () => signOut(auth));
        document.querySelectorAll('.nav-link').forEach(link => link.addEventListener('click', () => navigateTo(link.dataset.page)));
    </script>
</body>
</html>